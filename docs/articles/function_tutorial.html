<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Function tutorial • oddsratio</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">oddsratio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/function_tutorial.html">Function tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pat-s/oddsratio">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Function tutorial</h1>
                        <h4 class="author">Patrick Schratz</h4>
            
            <h4 class="date">2017-12-03</h4>
          </div>

    
    
<div class="contents">
<div id="load-example-data-fit-model" class="section level2">
<h2 class="hasAnchor">
<a href="#load-example-data-fit-model" class="anchor"></a>Load example data &amp; fit model</h2>
<p>Data source: <code><a href="http://www.rdocumentation.org/packages/mgcv/topics/predict.gam">?mgcv::predict.gam</a></code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(oddsratio)

fit_gam &lt;-<span class="st"> </span>mgcv::<span class="kw">gam</span>(y ~<span class="st"> </span><span class="kw">s</span>(x0) +<span class="st"> </span><span class="kw">s</span>(<span class="kw">I</span>(x1^<span class="dv">2</span>)) +<span class="st"> </span><span class="kw">s</span>(x2) +<span class="st"> </span><span class="kw">offset</span>(x3) +<span class="st"> </span>x4, 
                     <span class="dt">data =</span> data_gam)</code></pre></div>
</div>
<div id="gam-example" class="section level2">
<h2 class="hasAnchor">
<a href="#gam-example" class="anchor"></a>GAM example</h2>
<div id="calculate-or-for-specific-increment-step-of-continuous-variable" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-or-for-specific-increment-step-of-continuous-variable" class="anchor"></a>Calculate OR for specific increment step of continuous variable</h3>
<p>To calculate specific increment steps of <code>fit_gam</code>, we take predictor <code>x2</code> (randomly chosen) and specify for which values we want to calculate the odds ratio.<br>
We can see that the odds of response <code>y</code> happening are 22 times higher when predictor <code>x2</code> increases from 0.099 to 0.198 while holding all other predictors constant.</p>
<p>Add fake change</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/or_gam.html">or_gam</a></span>(<span class="dt">data =</span> data_gam, <span class="dt">model =</span> fit_gam, <span class="dt">pred =</span> <span class="st">"x2"</span>, 
       <span class="dt">values =</span> <span class="kw">c</span>(<span class="fl">0.099</span>, <span class="fl">0.198</span>))
<span class="co">#&gt;   predictor value1 value2 oddsratio CI_low (2.5%) CI_high (97.5%)</span>
<span class="co">#&gt; 1        x2  0.099  0.198  23.32353      23.30424        23.34283</span></code></pre></div>
<p>Usually, this calculation is done by setting all predictors to their mean value, predict the response, change the desired predictor to a new value and predict the response again. These actions results in two log odds values, respectively, which are transformed into odds by exponentiating them. Finally, the odds ratio can be calculated from these two odds values.</p>
</div>
<div id="calculate-or-for-level-change-of-indicator-variable" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-or-for-level-change-of-indicator-variable" class="anchor"></a>Calculate OR for level change of indicator variable</h3>
<p>If the predictor is an indicator variable, i.e. consists of fixed levels, you can use the function in the same way by just putting in the respective levels you are interested in:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/or_gam.html">or_gam</a></span>(<span class="dt">data =</span> data_gam, <span class="dt">model =</span> fit_gam, 
       <span class="dt">pred =</span> <span class="st">"x4"</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>))
<span class="co">#&gt;   predictor value1 value2 oddsratio CI_low (2.5%) CI_high (97.5%)</span>
<span class="co">#&gt; 1        x4      A      B  1.377537      1.334837        1.421604</span></code></pre></div>
<p>Here, the change in odds of <code>y</code> happening if predictor <code>x4</code> is changing from level <code>A</code> to <code>B</code> is rather small. In detail, an increase in odds of 37.8% is reported.</p>
</div>
<div id="calculate-ors-for-percentage-increments-of-predictor-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-ors-for-percentage-increments-of-predictor-distribution" class="anchor"></a>Calculate ORs for percentage increments of predictor distribution</h3>
<p>To get an impression of odds ratio behaviour throughout the complete range of the smoothing function of the fitted GAM model, you can calculate odds ratios based on percentage breaks of the predictors distribution.<br>
Here we slice predictor <code>x2</code> into 5 parts by taking the predictor values of every 20% increment step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/or_gam.html">or_gam</a></span>(<span class="dt">data =</span> data_gam, <span class="dt">model =</span> fit_gam, <span class="dt">pred =</span> <span class="st">"x2"</span>, 
       <span class="dt">percentage =</span> <span class="dv">20</span>, <span class="dt">slice =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt;   predictor value1 value2 perc1 perc2 oddsratio CI_low (2.5%)</span>
<span class="co">#&gt; 1        x2  0.001  0.200     0    20   2510.77       1091.68</span>
<span class="co">#&gt; 2        x2  0.200  0.400    20    40      0.03          0.03</span>
<span class="co">#&gt; 3        x2  0.400  0.599    40    60      0.58          0.56</span>
<span class="co">#&gt; 4        x2  0.599  0.799    60    80      0.06          0.06</span>
<span class="co">#&gt; 5        x2  0.799  0.998    80   100      0.41          0.75</span>
<span class="co">#&gt;   CI_high (97.5%)</span>
<span class="co">#&gt; 1         5774.53</span>
<span class="co">#&gt; 2            0.03</span>
<span class="co">#&gt; 3            0.60</span>
<span class="co">#&gt; 4            0.06</span>
<span class="co">#&gt; 5            0.22</span></code></pre></div>
<p>We can see that there is a high odds ratio reported when increasing predictor <code>x2</code> from 0.008 to 0.206 while all further predictor increases decrease the odds of response <code>y</code> happening substantially.</p>
</div>
<div id="plot-gamm-smoothing-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-gamm-smoothing-functions" class="anchor"></a>Plot GAM(M) smoothing functions</h3>
<p>Right now, the only (quick) possibility to plot the smoothing functions of a GAM(M) was to use the base <code>plot()</code> function. The fiddly work to do the same using the <code>ggplot2</code> plotting system is done by <code><a href="../reference/plot_gam.html">plot_gam()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_gam.html">plot_gam</a></span>(fit_gam, <span class="dt">pred =</span> <span class="st">"x2"</span>, <span class="dt">title =</span> <span class="st">"Predictor 'x2'"</span>)</code></pre></div>
<p><img src="function_tutorial_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<p>You can further customize the look using other colors or linetypes.</p>
</div>
<div id="add-odds-ratio-information-into-smoothing-function-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#add-odds-ratio-information-into-smoothing-function-plot" class="anchor"></a>Add odds ratio information into smoothing function plot</h3>
<p>So now, we have the odds ratios and we have a plot of the smoothing function. Why not combine both? We can do so using <code><a href="../reference/insert_or.html">insert_or()</a></code>. Its main arguments are (i) a <code>ggplot</code> plotting object containing the smooth function and a data frame returned from <code><a href="../reference/or_gam.html">or_gam()</a></code> containing information about the predictor and the respective values we want to insert.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_object &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_gam.html">plot_gam</a></span>(fit_gam, <span class="dt">pred =</span> <span class="st">"x2"</span>, <span class="dt">title =</span> <span class="st">"Predictor 'x2'"</span>)
or_object &lt;-<span class="st"> </span><span class="kw"><a href="../reference/or_gam.html">or_gam</a></span>(<span class="dt">data =</span> data_gam, <span class="dt">model =</span> fit_gam, 
                    <span class="dt">pred =</span> <span class="st">"x2"</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="fl">0.099</span>, <span class="fl">0.198</span>))

plot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/insert_or.html">insert_or</a></span>(plot_object, or_object, <span class="dt">or_yloc =</span> <span class="dv">3</span>,
                  <span class="dt">values_xloc =</span> <span class="fl">0.05</span>, <span class="dt">arrow_length =</span> <span class="fl">0.02</span>, 
                  <span class="dt">arrow_col =</span> <span class="st">"red"</span>)
plot</code></pre></div>
<p><img src="function_tutorial_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The odds ratio information is always centered between the two vertical lines. Hence it only looks nice if the gap between the two chosen values (here 0.099 and 0.198) is large enough. If the smoothing line crosses your inserted text, you can just correct it adjusting <code>or_yloc</code>. This param sets the y-location of the inserted odds ratio information.</p>
<p>Depending on the digits of your chosen values (here 3), you might also need to adjust the x-axis location of the two values so that they do not interfer with the vertical line.</p>
<p>Let’s do all this by inserting another odds ratio into this plot! This time we simply take the already produced plot as an input to <code><a href="../reference/insert_or.html">insert_or()</a></code> and use a new odds ratio object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">or_object2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/or_gam.html">or_gam</a></span>(<span class="dt">data =</span> data_gam, <span class="dt">model =</span> fit_gam, 
                     <span class="dt">pred =</span> <span class="st">"x2"</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>))

<span class="kw"><a href="../reference/insert_or.html">insert_or</a></span>(plot, or_object2, <span class="dt">or_yloc =</span> <span class="fl">2.1</span>, <span class="dt">values_yloc =</span> <span class="dv">2</span>,
          <span class="dt">line_col =</span> <span class="st">"green4"</span>, <span class="dt">text_col =</span> <span class="st">"black"</span>,
          <span class="dt">rect_col =</span> <span class="st">"green4"</span>, <span class="dt">rect_alpha =</span> <span class="fl">0.2</span>,
          <span class="dt">line_alpha =</span> <span class="dv">1</span>, <span class="dt">line_type =</span> <span class="st">"dashed"</span>,
          <span class="dt">arrow_xloc_r =</span> <span class="fl">0.01</span>, <span class="dt">arrow_xloc_l =</span> -<span class="fl">0.01</span>,
          <span class="dt">arrow_length =</span> <span class="fl">0.02</span>, <span class="dt">rect =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="function_tutorial_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Using <code>rect = TRUE</code>, you can additionally highlight certain odds ratio intervals. Aesthetics like opacity or color are fully customizable.</p>
</div>
</div>
<div id="glm-example" class="section level2">
<h2 class="hasAnchor">
<a href="#glm-example" class="anchor"></a>GLM example</h2>
<p>Fit model.<br>
Data source: <a href="http://www.ats.ucla.edu/stat/r/dae/logit.htm" class="uri">http://www.ats.ucla.edu/stat/r/dae/logit.htm</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit_glm &lt;-<span class="st"> </span><span class="kw">glm</span>(admit ~<span class="st"> </span>gre +<span class="st"> </span>gpa +<span class="st"> </span>rank, <span class="dt">data =</span> data_glm, <span class="dt">family =</span> <span class="st">"binomial"</span>)</code></pre></div>
<div id="calculate-odds-ratio-for-continuous-predictors" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-odds-ratio-for-continuous-predictors" class="anchor"></a>Calculate odds ratio for continuous predictors</h3>
<p>For GLMs, the odds ratio calculation is simpler because odds ratio changes correspond to fixed predictor increases throughout the complete value range of each predictor.</p>
<p>Hence, function <code>or_glm</code> takes the increment steps of each predictor directly as an input in its parameter <code>incr</code>.</p>
<p>To avoid false predictor/value assignments, the combinations need to be given in a list.</p>
<p>Odds ratios of indicator variables are computed automatically and do always refer to the base factor level.</p>
<p>Indicator predictor <code>rank</code> has four levels. Subsequently, we will get three odds ratio outputs referring to the base factor level (here: rank1).</p>
<p>The output is interpreted as follows: “Having <code>rank2</code> instead of <code>rank1</code> while holding all other values constant results in a decrease in odds of 49.1% (1-0.509)”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/or_glm.html">or_glm</a></span>(<span class="dt">data =</span> data_glm, <span class="dt">model =</span> fit_glm, <span class="dt">incr =</span> <span class="kw">list</span>(<span class="dt">gre =</span> <span class="dv">380</span>, <span class="dt">gpa =</span> <span class="dv">5</span>))
<span class="co">#&gt;   predictor oddsratio CI_low (2.5 %) CI_high (97.5 %)          increment</span>
<span class="co">#&gt; 1       gre     2.364          1.054            5.396                380</span>
<span class="co">#&gt; 2       gpa    55.712          2.229         1511.282                  5</span>
<span class="co">#&gt; 3     rank2     0.509          0.272            0.945 Indicator variable</span>
<span class="co">#&gt; 4     rank3     0.262          0.132            0.512 Indicator variable</span>
<span class="co">#&gt; 5     rank4     0.212          0.091            0.471 Indicator variable</span></code></pre></div>
<p>You can also set other confident intervals for GLM(M) models. The resulting data frame will automatically adjust its column names to the specified level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/or_glm.html">or_glm</a></span>(<span class="dt">data =</span> data_glm, <span class="dt">model =</span> fit_glm, 
       <span class="dt">incr =</span> <span class="kw">list</span>(<span class="dt">gre =</span> <span class="dv">380</span>, <span class="dt">gpa =</span> <span class="dv">5</span>), <span class="dt">CI =</span> <span class="fl">0.70</span>)
<span class="co">#&gt;   predictor oddsratio CI_low (15 %) CI_high (85 %)          increment</span>
<span class="co">#&gt; 1       gre     2.364         1.540          3.647                380</span>
<span class="co">#&gt; 2       gpa    55.712        10.084        314.933                  5</span>
<span class="co">#&gt; 3     rank2     0.509         0.366          0.706 Indicator variable</span>
<span class="co">#&gt; 4     rank3     0.262         0.183          0.374 Indicator variable</span>
<span class="co">#&gt; 5     rank4     0.212         0.136          0.325 Indicator variable</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-example-data-fit-model">Load example data &amp; fit model</a></li>
      <li><a href="#gam-example">GAM example</a></li>
      <li><a href="#glm-example">GLM example</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Patrick Schratz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
